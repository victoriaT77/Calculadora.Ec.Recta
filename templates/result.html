<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultado del Plano</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <div class="container mt-4">
        <h2>âœ… EcuaciÃ³n del plano:</h2>
        <p class="fs-4">{{ plane_eq }}</p>
        <div id="plot3d" style="height:600px;"></div>
        <a href="/" class="btn btn-secondary mt-4">ðŸ”™ Volver</a>
    </div>

    <script>
        // âœ… Aseguramos que los datos estÃ©n correctamente serializados
        const points = JSON.parse('{{ points_json | tojson | safe }}');
        const normal = JSON.parse('{{ normal_json | tojson | safe }}');

        const A = points[0];
        const B = points[1];
        const C = points[2];

        const AB = [B[0] - A[0], B[1] - A[1], B[2] - A[2]];
        const AC = [C[0] - A[0], C[1] - A[1], C[2] - A[2]];

        const s = [...Array(10).keys()].map(i => i / 5 - 1);
        const t = [...Array(10).keys()].map(i => i / 5 - 1);

        const x = [], y = [], z = [];
        for (let i = 0; i < s.length; i++) {
            x[i] = [], y[i] = [], z[i] = [];
            for (let j = 0; j < t.length; j++) {
                x[i][j] = A[0] + s[i] * AB[0] + t[j] * AC[0];
                y[i][j] = A[1] + s[i] * AB[1] + t[j] * AC[1];
                z[i][j] = A[2] + s[i] * AB[2] + t[j] * AC[2];
            }
        }

        const surface = {
            type: 'surface',
            x: x, y: y, z: z,
            colorscale: 'Viridis',
            opacity: 0.7,
            showscale: false
        };

        const points_trace = {
            type: 'scatter3d',
            mode: 'markers+text',
            x: points.map(p => p[0]),
            y: points.map(p => p[1]),
            z: points.map(p => p[2]),
            text: ['A', 'B', 'C'],
            textposition: 'top center',
            marker: { size: 6, color: ['red', 'green', 'blue'] }
        };

        const cone = {
            type: 'cone',
            x: [A[0]], y: [A[1]], z: [A[2]],
            u: [normal[0]], v: [normal[1]], w: [normal[2]],
            sizemode: 'absolute', sizeref: 2,
            anchor: 'tail', colorscale: 'Reds'
        };

        Plotly.newPlot('plot3d', [surface, points_trace, cone], {
            scene: {
                xaxis: { title: 'X' },
                yaxis: { title: 'Y' },
                zaxis: { title: 'Z' },
                aspectmode: 'cube',
                camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
            },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { color: 'white' }
        });
    </script>
</body>
</html>